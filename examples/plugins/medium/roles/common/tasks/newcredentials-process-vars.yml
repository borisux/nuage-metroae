- name: Create vars for credentials
  block:

  - name: Create credentials files for {{ component_template }}
    template: src=newcredentials.j2 backup=no dest={{ inventory_dir }}/host_vars/newcredentials

  - name: Append credentials to the component host vars
    blockinfile:
      path: "{{ inventory_dir }}/host_vars/{{ newcredentials.name }}"
      block: "{{ lookup('file', '{{ inventory_dir }}/host_vars/newcredentials') }}"
      insertafter: EOF

  when:
    - newcredentials is defined and newcredentials|length > 0
